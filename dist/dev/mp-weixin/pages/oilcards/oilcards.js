"use strict";const e=require("../../common/vendor.js");require("../../store/index.js"),require("../../utils/http.js");const a=require("../../api/modules/oil.js"),t=require("../../constants/index.js"),r=require("../../utils/index.js"),s=require("../../utils/router.js"),n=require("../../store/modules/user.js");Math||(u+o)();const u=()=>"../../components/Empty/Empty.js",o=()=>"../../components/BalanceCard/BalanceCard.js",i={__name:"oilcards",setup(u,{expose:o}){const i=n.useUserStore(),c=e.ref([]),l=e.ref([]),d=e.ref(0),v=e.ref(!1),m=e.computed(()=>0===c.value.length),p=e.computed(()=>c.value[d.value]||null),f=async()=>{v.value=!0;try{const e={};i.userInfo&&(i.userInfo.userId||i.userInfo.id)&&(e.user_id=i.userInfo.userId||i.userInfo.id);const t=await a.getOilCards(e),r=Array.isArray(t)?t:t.list||[],s={1:"汽油",2:"柴油"},n={1:"active",2:"inactive",3:"expired"};c.value=r.map(e=>({id:e.cardNo||e.id,name:""+(s[e.cardType]?s[e.cardType]+"卡":"油卡"),cardNo:e.cardNo,balance:"number"==typeof e.balanceCents?e.balanceCents:e.balance||0,status:n[e.status]||(1===e.status?"active":"inactive"),raw:e}))}catch(e){}finally{v.value=!1}},y=e=>{d.value=e,(async()=>{if(p.value)try{const e=await a.getTransactions({cardId:p.value.id,pageSize:5});l.value=e.list||[]}catch(e){}})()},h=()=>{s.router.push(t.PAGES.OIL_ACTIVATE)},j=()=>{e.index.showToast({title:"敬请期待",icon:"none"})},I=()=>{p.value&&e.index.showToast({title:"敬请期待",icon:"none"})};return e.onMounted(()=>{f()}),o({onShow(){f()}}),(a,t)=>e.e({a:m.value},m.value?{b:e.o(h),c:e.p({img:"truck",text:"您当前还没有加油卡，赶紧前往激活吧！"})}:e.e({d:e.f(c.value,(a,t,r)=>({a:e.t(a.name),b:a.id,c:d.value===t?1:"",d:e.o(e=>y(t),a.id)})),e:p.value},p.value?{f:e.o(j),g:e.o(I),h:e.p({title:p.value.name,"card-no":p.value.cardNo,balance:p.value.balance,status:p.value.status})}:{},{i:l.value.length>0},l.value.length>0?{j:e.f(l.value,(a,t,s)=>{return{a:e.t(a.description),b:e.t(a.createTime),c:e.t(a.amount>0?"+":""),d:e.t((n=a.amount,r.formatMoney(n))),e:a.amount>0?1:"",f:a.id};var n})}:{}))}},c=e._export_sfc(i,[["__scopeId","data-v-9d2ad4d5"]]);wx.createPage(c);
