"use strict";const e=require("../../common/vendor.js"),n=require("../../common/assets.js");require("../../store/index.js"),require("../../utils/http.js");const o=require("../../api/modules/user.js"),a=require("../../constants/index.js"),t=require("../../utils/router.js"),s=require("../../store/modules/user.js");Math||r();const r=()=>"../../components/TabBar/TabBar.js",u={__name:"index",setup(r){const u=s.useUserStore(),i=e.ref({points:0,coupons:0,balance:0}),c=e.ref(e.index.getStorageSync("wx_temp_user")||null),l=e.computed(()=>u.userName&&"未登录"!==u.userName?u.userName:c.value&&(c.value.nickName||c.value.nickname)||"未登录"),p=e.computed(()=>u.userAvatar&&!u.userAvatar.includes("avatar.png")?u.userAvatar:c.value&&(c.value.avatarUrl||c.value.avatar_url)||"/static/personal/avatar.png"),d=e.ref([{id:1,name:"交易记录",icon:"/static/personal/solution.png",url:""},{id:2,name:"个人资料",icon:"/static/personal/idcard.png",url:""},{id:3,name:"帮助反馈",icon:"/static/personal/bug.png",url:""},{id:4,name:"系统设置",icon:"/static/personal/setting.png",url:""}]),g=async()=>{const n=e.index.getStorageSync("wx_temp_openId")||null;if(u.isLoggedIn||n)try{if(u.isLoggedIn){const e=u.userInfo||{};return void(i.value={points:e.points||0,coupons:e.coupons||0,balance:e.balance||0})}if(n){const e=await o.getUserInfo({openId:n});i.value={points:e.points||0,coupons:e.coupons||0,balance:e.balance||0},u.updateUserInfo(e)}}catch(a){}},m=()=>{u.isLoggedIn||t.router.push(a.PAGES.LOGIN)},v=()=>{t.router.push(a.PAGES.QRCODE)},_=()=>{e.index.showModal({title:"提示",content:"确定退出登录吗？",success:e=>{e.confirm&&(u.logout(),t.router.reLaunch(a.PAGES.LOGIN))}})};return e.onMounted(()=>{g()}),e.onShow(()=>{c.value=e.index.getStorageSync("wx_temp_user")||null,g()}),(o,a)=>e.e({a:p.value,b:e.o(m),c:e.t(l.value),d:n._imports_0$1,e:e.o(v),f:n._imports_1,g:e.t(i.value.points||0),h:e.t(i.value.coupons||0),i:e.t(i.value.balance||0),j:e.f(d.value,(n,o,a)=>({a:n.icon,b:e.t(n.name),c:n.id,d:e.o(o=>(n=>{n.url?t.router.push(n.url):e.index.showToast({title:"敬请期待",icon:"none"})})(n),n.id)})),k:e.unref(u).isLoggedIn},e.unref(u).isLoggedIn?{l:e.o(_)}:{},{m:e.p({"current-index":2})})}},i=e._export_sfc(u,[["__scopeId","data-v-b1f18929"]]);wx.createPage(i);
